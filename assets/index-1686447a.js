var p=Object.defineProperty;var E=(a,e,t)=>e in a?p(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var i=(a,e,t)=>(E(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();const c="columns-resize-connected",d="columns-resize-active",u="columns-resize-growing",f="columns-resize-shrinking";class C{constructor(e,t,n,s=50,l){i(this,"elements");i(this,"minWidth");i(this,"width",0);i(this,"idx");i(this,"columns");i(this,"handleElements",[]);i(this,"id");i(this,"autoResizeHandles");this.id=e,this.elements=t,this.columns=n,this.idx=n.columns.length,this.minWidth=s,this.autoResizeHandles=l}get next(){return this.columns.columns[this.idx+1]}get previous(){return this.columns.columns[this.idx-1]}get canShrink(){return this.width>this.minWidth}get nextShrinkable(){let e=this.next;for(;e&&!e.canShrink;)e=e.next;return e}get selfOrPreviousShrinkable(){let e=this;for(;e&&!e.canShrink;)e=e.previous;return e}get isLast(){return this.idx==this.columns.columns.length-1}getWidth(){const e=this.elements.map(n=>n.clientWidth),t=e.reduce((n,s)=>n+s,0)/e.length;this.width=t}setWidthDiff(e,t=!1){this.width+=e;const n=t&&this.canShrink?"1":"0",s=t?"1":"0",l=`${this.width}px`;this.elements.forEach(o=>{o.style.flex=`${s} ${n} ${l}`})}createHandlebars(){this.idx!=this.columns.columns.length-1&&this.elements.forEach(e=>{if(e.closest("[data-no-auto-resize-handles]")||e.querySelector("[data-resize-handle]"))return;const t=document.createElement("div");t.targetColumn=this,t.setAttribute("data-resize-handle",""),e.append(t)})}connectHandlebars(){this.handleElements=[],this.autoResizeHandles&&this.createHandlebars(),this.elements.forEach(e=>{const t=e.querySelector("[data-resize-handle]");t&&(t.targetColumn=this,this.handleElements.push(t))}),this.handleElements.forEach(e=>{e.addEventListener("pointerdown",this.columns.onPointerDown)}),this.addElementsClass(c),this.addHandlebarsClass(c)}disconnectHandlebars(){this.handleElements.forEach(e=>{e.removeEventListener("pointerdown",this.columns.onPointerDown)}),this.removeElementsClass(c),this.removeHandlebarsClass(c)}addElementsClass(e){this.elements.forEach(t=>{t.classList.add(e)})}removeElementsClass(e){this.elements.forEach(t=>{t.classList.remove(e)})}addHandlebarsClass(e){this.handleElements.forEach(t=>{t.classList.add(e)})}removeHandlebarsClass(e){this.handleElements.forEach(t=>{t.classList.remove(e)})}}class b{constructor(e,t){i(this,"columns",[]);i(this,"rootElement");i(this,"opts");i(this,"targetColumn");i(this,"lastResizeEventX",0);i(this,"lastGrowingColumn");i(this,"lastShrinkingColumn");i(this,"initialWidths",new Map);i(this,"lastWidths",new Map);i(this,"isPointerDown",!1);i(this,"pendingCallbacks",[]);i(this,"isInit",!1);i(this,"onPointerDown",e=>{var t,n;this.isPointerDown=!0,this.columns.forEach(s=>{s.getWidth(),s.setWidthDiff(0)}),this.lastResizeEventX=e.clientX,this.targetColumn=e.target.targetColumn,document.addEventListener("pointerup",this.onPointerUp,{once:!0}),document.addEventListener("pointermove",this.onPointerMove),this.rootElement.classList.add(d),this.targetColumn.addHandlebarsClass(d),(n=(t=this.opts)==null?void 0:t.onResizeStart)==null||n.call(t)});i(this,"onPointerUp",()=>{var e,t,n;this.isPointerDown=!1,this.columns.forEach(s=>s.setWidthDiff(0,!0)),document.removeEventListener("pointermove",this.onPointerMove),this.rootElement.classList.remove(d),(e=this.targetColumn)==null||e.removeHandlebarsClass(d),this.handleColumnsClasses(null,null),(n=(t=this.opts)==null?void 0:t.onResizeEnd)==null||n.call(t)});i(this,"onPointerMove",e=>{var o,h,r;const t=e.clientX-this.lastResizeEventX;let n,s;if(t<0?(n=(o=this.targetColumn)==null?void 0:o.selfOrPreviousShrinkable,s=(h=this.targetColumn)==null?void 0:h.next):(n=(r=this.targetColumn)==null?void 0:r.nextShrinkable,s=this.targetColumn),!n||!s)return;const l=Math.min(Math.abs(t),n.width-n.minWidth);n.setWidthDiff(-l),s.setWidthDiff(l),this.handleColumnsClasses(s,n),this.lastResizeEventX=e.clientX});this.rootElement=e,this.opts=t,this.init()}async init(){var o,h;(o=this.logger)==null||o.log("init runs"),this.isInit=!1;const{minWidthByColumnId:e={},defaultMinWidth:t=50,autoResizeHandles:n=!1}=this.opts||{};this.columns=[];const s=[...this.rootElement.querySelectorAll("[data-column-id]")];new Set(s.map(r=>r.dataset.columnId)).forEach(r=>{this.columns.push(new C(r,s.filter(g=>g.dataset.columnId==r),this,r in e?e[r]:t,n))}),await this.prepare(),this.connect(),this.isInit=!0,(h=this.logger)==null||h.log("init done"),this.callPendingCallbacks()}async callPendingCallbacks(){var t;const e=this.pendingCallbacks;if(e.length){this.pendingCallbacks=[],(t=this.logger)==null||t.log("calling pending callbacks");for(const[n,s]of e)await s()}}addDedupedPendingCallback(e,t){var n;if(this.isInit){t();return}this.pendingCallbacks=this.pendingCallbacks.filter(([s])=>e!==s),this.pendingCallbacks.push([e,t]),(n=this.logger)==null||n.log('added pending callback "'+e+'" to run after init (deduped)',this.pendingCallbacks.map(([s])=>s))}trackColumnsChange(){const e=this.columns.map(t=>t.id);return this.initialWidths.size!=e.length||!e.every(t=>this.initialWidths.has(t))}overwriteWidthsMap(e){e.clear(),this.columns.forEach(t=>{e.set(t.id,t.width)})}async prepare(){const e=this.trackColumnsChange();await Promise.all(this.columns.map(t=>new Promise(n=>{t.elements.forEach(s=>{s.style.boxSizing="border-box",s.style.overflow="hidden",s.style.minWidth=t.minWidth+"px"}),requestAnimationFrame(()=>{e?t.getWidth():t.width=this.lastWidths.get(t.id),t.setWidthDiff(0,!0),n()})}))).then(()=>{e&&this.overwriteWidthsMap(this.initialWidths)})}connect(){this.columns.forEach(e=>e.connectHandlebars()),this.rootElement.classList.add(c)}disconnect(){var e;(e=this.logger)==null||e.log("disconnect called"),this.addDedupedPendingCallback("disconnect",()=>{var t,n;(t=this.logger)==null||t.log("disconnect runs"),this.isPointerDown&&this.onPointerUp(),this.overwriteWidthsMap(this.lastWidths),this.columns.forEach(s=>s.disconnectHandlebars()),this.rootElement.classList.remove(c),(n=this.logger)==null||n.log("disconnect done")})}reconnect(){var e;(e=this.logger)==null||e.log("reconnect called"),this.addDedupedPendingCallback("reconnect",async()=>{var t,n;(t=this.logger)==null||t.log("reconnect runs"),this.disconnect(),await this.init(),(n=this.logger)==null||n.log("reconnect done")})}reset(){this.columns.forEach(e=>{e.width=this.initialWidths.get(e.id),e.setWidthDiff(0,!0)})}handleColumnsClasses(e,t){var n,s,l,o;this.lastGrowingColumn!=e&&(e==null||e.addElementsClass(d),e==null||e.addElementsClass(u),(n=this.lastGrowingColumn)==null||n.removeElementsClass(u),this.lastGrowingColumn!=t&&((s=this.lastGrowingColumn)==null||s.removeElementsClass(d))),this.lastShrinkingColumn!=t&&(t==null||t.addElementsClass(d),t==null||t.addElementsClass(f),(l=this.lastShrinkingColumn)==null||l.removeElementsClass(f),this.lastShrinkingColumn!=e&&((o=this.lastShrinkingColumn)==null||o.removeElementsClass(d))),this.lastGrowingColumn=e,this.lastShrinkingColumn=t}get logger(){var e;if((e=this.opts)!=null&&e.logs)return console}}const v=document.querySelector(".row:last-child").cloneNode(!0),w=()=>v.cloneNode(!0),m=new b(document.querySelector("#wrapper"),{defaultMinWidth:70,minWidthByColumnId:{name:50},autoResizeHandles:!0,onResizeStart(){document.body.classList.add("grabbing"),console.log("resize start")},onResizeEnd(){document.body.classList.remove("grabbing"),console.log("resize end")},logs:!0});document.getElementById("disconnect").onclick=()=>{m.disconnect()};document.getElementById("reconnect").onclick=a=>{m.reconnect(),a.target.classList.remove("attention")};document.getElementById("reset").onclick=()=>{m.reset()};document.getElementById("add-row").onclick=()=>{document.getElementById("wrapper").appendChild(w()),document.getElementById("reconnect").classList.add("attention")};document.getElementById("colors-cbx").onchange=()=>{document.getElementById("wrapper").classList.toggle("colors")};
