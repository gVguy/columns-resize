var E=Object.defineProperty;var p=(r,e,t)=>e in r?E(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var o=(r,e,t)=>(p(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const h="columns-resize-connected",a="columns-resize-active",u="columns-resize-growing",f="columns-resize-shrinking";class v{constructor(e,t,n,s=50,i){o(this,"elements");o(this,"minWidth");o(this,"width",0);o(this,"idx");o(this,"columns");o(this,"handleElements",[]);o(this,"id");o(this,"autoResizeHandles");this.id=e,this.elements=t,this.columns=n,this.idx=n.columns.length,this.minWidth=s,this.autoResizeHandles=i}get next(){return this.columns.columns[this.idx+1]}get previous(){return this.columns.columns[this.idx-1]}get canShrink(){return this.width>this.minWidth}get nextShrinkable(){let e=this.next;for(;e&&!e.canShrink;)e=e.next;return e}get selfOrPreviousShrinkable(){let e=this;for(;e&&!e.canShrink;)e=e.previous;return e}get isLast(){return this.idx==this.columns.columns.length-1}getWidth(){const e=this.elements.map(n=>n.clientWidth),t=e.reduce((n,s)=>n+s,0)/e.length;this.width=t}setWidthDiff(e,t=!1){this.width+=e;const n=t&&this.canShrink?"1":"0",s=t?"1":"0",i=`${this.width}px`;this.elements.forEach(l=>{l.style.flex=`${s} ${n} ${i}`})}createHandlebars(){this.idx!=this.columns.columns.length-1&&this.elements.forEach(e=>{if(e.closest("[data-no-auto-resize-handles]")||e.querySelector("[data-resize-handle]"))return;const t=document.createElement("div");t.targetColumn=this,t.setAttribute("data-resize-handle",""),e.append(t)})}connectHandlebars(){this.handleElements=[],this.autoResizeHandles&&this.createHandlebars(),this.elements.forEach(e=>{const t=e.querySelector("[data-resize-handle]");t&&(t.targetColumn=this,this.handleElements.push(t))}),this.handleElements.forEach(e=>{e.addEventListener("pointerdown",this.columns.onPointerDown)}),this.addElementsClass(h),this.addHandlebarsClass(h)}disconnectHandlebars(){this.handleElements.forEach(e=>{e.removeEventListener("pointerdown",this.columns.onPointerDown)}),this.removeElementsClass(h),this.removeHandlebarsClass(h)}addElementsClass(e){this.elements.forEach(t=>{t.classList.add(e)})}removeElementsClass(e){this.elements.forEach(t=>{t.classList.remove(e)})}addHandlebarsClass(e){this.handleElements.forEach(t=>{t.classList.add(e)})}removeHandlebarsClass(e){this.handleElements.forEach(t=>{t.classList.remove(e)})}}class C{constructor(e,t){o(this,"columns",[]);o(this,"rootElement");o(this,"opts");o(this,"targetColumn");o(this,"lastResizeEventX",0);o(this,"lastGrowingColumn");o(this,"lastShrinkingColumn");o(this,"initialWidths",new Map);o(this,"beforeDisconnectWidths",new Map);o(this,"isPointerDown",!1);o(this,"onPointerDown",e=>{var t,n;this.isPointerDown=!0,this.columns.forEach(s=>{s.getWidth(),s.setWidthDiff(0)}),this.lastResizeEventX=e.clientX,this.targetColumn=e.target.targetColumn,document.addEventListener("pointerup",this.onPointerUp,{once:!0}),document.addEventListener("pointermove",this.onPointerMove),this.rootElement.classList.add(a),this.targetColumn.addHandlebarsClass(a),(n=(t=this.opts)==null?void 0:t.onResizeStart)==null||n.call(t)});o(this,"onPointerUp",()=>{var e,t,n;this.isPointerDown=!1,this.columns.forEach(s=>s.setWidthDiff(0,!0)),document.removeEventListener("pointermove",this.onPointerMove),this.rootElement.classList.remove(a),(e=this.targetColumn)==null||e.removeHandlebarsClass(a),this.handleColumnsClasses(null,null),(n=(t=this.opts)==null?void 0:t.onResizeEnd)==null||n.call(t)});o(this,"onPointerMove",e=>{var l,d,m;const t=e.clientX-this.lastResizeEventX;let n,s;if(t<0?(n=(l=this.targetColumn)==null?void 0:l.selfOrPreviousShrinkable,s=(d=this.targetColumn)==null?void 0:d.next):(n=(m=this.targetColumn)==null?void 0:m.nextShrinkable,s=this.targetColumn),!n||!s)return;const i=Math.min(Math.abs(t),n.width-n.minWidth);n.setWidthDiff(-i),s.setWidthDiff(i),this.handleColumnsClasses(s,n),this.lastResizeEventX=e.clientX});this.rootElement=e,this.opts=t,this.init(),this.prepare(),this.connect()}init(){const{minWidthByColumnId:e={},defaultMinWidth:t=50,autoResizeHandles:n=!1}=this.opts||{};this.columns=[];const s=[...this.rootElement.querySelectorAll("[data-column-id]")];new Set(s.map(l=>l.dataset.columnId)).forEach(l=>{this.columns.push(new v(l,s.filter(d=>d.dataset.columnId==l),this,l in e?e[l]:t,n))})}trackColumnsChange(){const e=this.columns.map(t=>t.id);return this.initialWidths.size!=e.length||!e.every(t=>this.initialWidths.has(t))}overwriteWidthsMap(e){e.clear(),this.columns.forEach(t=>{e.set(t.id,t.width)})}prepare(){const e=this.trackColumnsChange();Promise.all(this.columns.map(t=>new Promise(n=>{t.elements.forEach(s=>{s.style.boxSizing="border-box",s.style.overflow="hidden",s.style.minWidth=t.minWidth+"px"}),requestAnimationFrame(()=>{e?t.getWidth():t.width=this.beforeDisconnectWidths.get(t.id),t.setWidthDiff(0,!0),n()})}))).then(()=>{e&&this.overwriteWidthsMap(this.initialWidths)})}connect(){this.columns.forEach(e=>e.connectHandlebars()),this.rootElement.classList.add(h)}disconnect(){this.isPointerDown&&this.onPointerUp(),this.overwriteWidthsMap(this.beforeDisconnectWidths),this.columns.forEach(e=>e.disconnectHandlebars()),this.rootElement.classList.remove(h)}reconnect(){this.disconnect(),this.init(),this.prepare(),this.connect()}reset(){this.columns.forEach(e=>{e.width=this.initialWidths.get(e.id),e.setWidthDiff(0,!0)})}handleColumnsClasses(e,t){var n,s,i,l;this.lastGrowingColumn!=e&&(e==null||e.addElementsClass(a),e==null||e.addElementsClass(u),(n=this.lastGrowingColumn)==null||n.removeElementsClass(u),this.lastGrowingColumn!=t&&((s=this.lastGrowingColumn)==null||s.removeElementsClass(a))),this.lastShrinkingColumn!=t&&(t==null||t.addElementsClass(a),t==null||t.addElementsClass(f),(i=this.lastShrinkingColumn)==null||i.removeElementsClass(f),this.lastShrinkingColumn!=e&&((l=this.lastShrinkingColumn)==null||l.removeElementsClass(a))),this.lastGrowingColumn=e,this.lastShrinkingColumn=t}}const g=document.querySelector(".row:last-child").cloneNode(!0),b=()=>g.cloneNode(!0),c=new C(document.querySelector("#wrapper"),{defaultMinWidth:70,minWidthByColumnId:{name:50},autoResizeHandles:!0,onResizeStart(){document.body.classList.add("grabbing"),console.log("resize start")},onResizeEnd(){document.body.classList.remove("grabbing"),console.log("resize end")}});document.getElementById("disconnect").onclick=()=>{c.disconnect()};document.getElementById("reconnect").onclick=r=>{c.reconnect(),r.target.classList.remove("attention")};document.getElementById("reset").onclick=()=>{c.reset()};document.getElementById("add-row").onclick=()=>{document.getElementById("wrapper").appendChild(b()),document.getElementById("reconnect").classList.add("attention")};document.getElementById("colors-cbx").onchange=()=>{document.getElementById("wrapper").classList.toggle("colors")};
